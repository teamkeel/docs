# What are Jobs?

Jobs are the Keel way to deal with tasks that either:

- You want to run on a scheduled basis (like every Friday),
- Take longer to run than a normal function (like a batch data import),
- You want to execute in the background away from your normal workflow.

You specify them just like everything else - in your Schema. 
Job definitions are root level blocks, along with Models, Roles and APIs.

```keel filename="schema.keel"
job EmailNewCustomerReport {
    @schedule("* * * * 5")
}
```

To define a schedule for a job, you can declare a `@schedule` attribute. 
This attribute takes a single argument, a String in [cron](https://devhints.io/cron) format.
The one in the example above declares a job that runs every Friday, Friday being the fifth day of the week. A job defined without a schedule
is invalid.

## So What Happens?

Once you've specified your Job in the Schema, you can run `keel generate` in the CLI - and it will auto-generate the "skeleton" for your function in 
your projects `./jobs` directory, ready to put some logic code into. 

It looks like this:

```tsx filename="jobs/emailNewCustomerReport.ts"
export default EmailNewCustomerReport(async (ctx) => {
  // your logic code here
});
```

At the time specified inside your `@schedule` attribute, Keel will execute your job.

# What Can Job Functions Do?
Jobs can do anything that a function can do.

- They have read and write access to your database - via the `Model API`
- They can make requests to external services using `fetch`
- They can import and use any third party npm packages of your choice

Scheduled jobs **cannot** receive an input. Note how the generated function signature in the example above does not specify
an input argument.

Scheduled jobs also do not have access to the `identity` attribute inside the `ctx` argument of the function. This is because they are executed by Keel, and not a specific user.

> **Manual** jobs are coming soon. 
> 
> These are jobs that can take inputs and which you are able to execute manually from the Keel console.

# How to Develop, Test And Debug Your Job

The CLI includes support for running jobs - to help you develop and debug your Function.

But you do it with the CLI's Test command - but don't forget `keel test` does not touch your real database. Instead it uses a special dedicated temporary database for each test run. That means you can experiment with creating Models in your database over and over without messing up your real database.

pete thinking out loud here...

dive straight in with writing a test (trust me)
then run the command
what happens?
then what do you do?
say anything about database - access it with 3rd party tool
skim or refer elsewhere for model API
how to use vscode debugger in this context

### Here's how you use `keel test` for Jobs

todo

# Jobs Pages in the Keel Console

If you visit the Keel Console you'll see a Jobs section in the side bar - which lets
you view all the jobs you've defined in your schema - and look into individual runs of each job.

![Jobs intro](/jobs-intro.png)

What you can do here:

| Task | How |     |
| ---  | --- | --- |
| See complete Run history | go to the `Run History` tab |
| Focus-in on one named Job | click that row | takes you to a Job Details page |
| See what happened on one particular run | click that run | (on the Job Details page) |
| See which of your code commits it used | click the `current build` link | (good for debugging a job) |





# todo

- address PR feedback
- switch in better screenshots 
- permissions
- code examples
- the `ctx` argument
- a job can have more than one schedule
- provide more cross references to say functions, the CLI, the model API etc
- split the content across a few (shorter) pages
- replace the "cron" external link to a better one
- there are some other unused jobs related images in /public - should be purged




