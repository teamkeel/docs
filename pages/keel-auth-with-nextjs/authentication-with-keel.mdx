Authentication with Keel is a breeze, all we need to do is call the authenticate endpoint, pass in our username and password and tell the application what to do when authentication is successful.

For every authentication request, Keel returns a JWT token, this token will act as a security mechanism to call other endpoints in our API. Let’s implement this.

Add the following to your `page.tsx` file:

```tsx {9, 21-28, 31-32}
'use client';
import { useState } from 'react';
import { useKeel } from '@/utils/keelContext';
import styled, { keyframes } from 'styled-components';

function HomePage() {

// initialize keel client
const keel = useKeel();

// Form state
const [email, setEmail] = useState('');
const [password, setPassword] = useState('');
const [message, setMessage] = useState('');
const [isLoggedIn, setIsLoggedIn] = useState(false);

// handle user login
const handleLogin = async (e: { preventDefault: () => void }) => {
    e.preventDefault();
    try {
	// Call the Keel authenticate function
      const response = await keel.api.mutations.authenticate({
        emailPassword: {
          email: email,
          password: password,
        },
        createIfNotExists: true,
      });

      if (response && response.data && response.data.token) {
	 // Set the Keel client token
        keel.client.setToken(response.data.token);
        setIsLoggedIn(true);
        setMessage('Logged in successfully!');
      } else {
        setMessage('Failed to log in' + response.error?.message);
      }
    } catch (error) {
      setMessage('Login error');
    }
  };

  return (
    <div>
        <Container>
          <form onSubmit={handleLogin}>
            <H2>Sign Up</H2>
            <div>
              <Input
                type="email"
                value={email}
                placeholder="Email"
                onChange={(e) => setEmail(e.target.value)}
                required
              />
            </div>
            <div>
              <Input
                type="password"
                value={password}
                placeholder="Password"
                required
                onChange={(e) => setPassword(e.target.value)}
              />
            </div>
            <div>
              <Button type="submit">Sign Up</Button>
            </div>
          </form>
        </Container>
        </div>
  );
}

const Container = styled.div`
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background-color: #f8f8f8;
`;

const slideIn = keyframes`
  from {
    transform: translateY(20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
`;

const Input = styled.input`
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  border-radius: 5px;
  border: 1px solid #ddd;
  font-size: 16px;
  animation: ${slideIn} 0.5s ease-in-out;
  &:focus {
    outline: none;
    box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1), -2px -2px 4px rgba(255, 255, 255, 0.5);
  }
`;

const Button = styled.button`
  background-color: #4caf50; /* Green */
  border: none;
  color: white;
  padding: 15px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  transition-duration: 0.4s;
  cursor: pointer;
  border-radius: 5px;

  &:hover {
    background-color: white;
    color: black;
    border: 1px solid #4caf50;
  }
`;

const Message = styled.p`
  margin: 5px 0;
  animation: ${slideIn} 0.5s ease-in-out;
`;

const H2 = styled.h2`
  color: #333;
  margin-bottom: 20px;
`;

export default HomePage;
```

What we have done is initialize the keel client with `useKeel()`, create state objects to manipulate our form state and finally create a `handleLogin` function to help us with authentication. The most important aspect of the `handleLogin` function is:

```tsx
const response = await keel.api.mutations.authenticate({
        emailPassword: {
          email: email,
          password: password,
        },
        createIfNotExists: true,
 });
```

Creating an authentication function with Keel is straightforward. Simply call the built-in **`authenticate`** function, and pass in an **`emailPassword`** object with your email and password. Utilize the **`createIfNotExists`** option: if set to `true`, it will authenticate a non-existing user as a new one; if `false`, it will deny login access to users not in the database. Essentially, this mechanism enables you to implement both sign-up and log-in features with a single option.

```tsx
setIsLoggedIn(true);
```

We added a state object called `isLoggedIn` that helps us check if a user is logged in or not. This will help control what part of our page is shown when a user is logged in or not

```tsx
keel.client.setToken(response.data.token);
```

Here, we are setting a bearer token for the rest of our application with the token that is returned when authentication is successful. We need this token to perform API calls to the rest of our endpoints.

The next thing we need to do is to create the UI that allows us to create a new user, assign a role to that user and see it reflected in the database. We need to also make sure that you can only see this UI when you’re logged in.
